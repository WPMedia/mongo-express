{% extends 'layout.html' %}

{% block breadcrumb %}

{% include 'breadcrumb.html' %}

{% endblock %}

{% block title %}Restore database{% endblock %}




{% block content %}


<h2>{{action}} Databases</h2>
<table class="table">
  <thead>
    <tr>
      <th>Date/time</th>
      <th>Db name</th>
      <th>Collection</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for file in fileList|reverse %}
    <tr class="restore-file" file-name="{{ file.filename }}">
      <td style="padding-left:10px">{{ file.backupDate }}</td>
      <td style="padding-left:10px">
        <a href="/db/{{ file.dbname }}">{{ file.dbname }}</a>
      </td>
      <td style="padding-left:10px">
        <a href="/db/{{ file.dbname }}/{{file.collection}}">{{ file.collection }}</a>
      </td>
      {% if !settings.read_only %}
      <td class="col-md-2">
        <a class="restoreTo" style="cursor:pointer" file-name="{{ file.filename }}">restore</a>
      </td>
      {% endif %}
    </tr>
  {% endfor %}
  </tbody>
</table>
<!--list all the db and collections-->
<div class="select-db-list" style="display:none">
  <h5>Select a database</h5>
  <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
    {% for db in databases %}
    <div class="panel panel-default database" db-name="{{ db }}">
      <div class="panel-heading" role="tab" id="heading-{{loop.index}}">
        <h4 class="panel-title">
          <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-{{loop.index}}" aria-expanded="false" aria-controls="collapse-{{loop.index}}">
            {{db}}
          </a>
        </h4>
      </div>
      <div id="collapse-{{loop.index}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-{{loop.index}}">
        <div class="panel-body">
          <h5 style="margin-top:0">select a collection for restore</h5>
          <form name="{{db}}-collections">
            <!--<div class="checkbox">
              <label>
                <input type="checkbox" name="all-collections"> Select all
              </label>
            </div>-->
            {% for collection in collections[db] %}
            <div class="checkbox" style="padding-left:10px">
              <label>
                <input type="radio" name="toCollection" value="{{collection}}"> {{collection}}
              </label>
            </div>
            {% endfor %}
            <div class="checkbox" style="padding-left:10px">
              <label>
                <input type="radio" id="newCollection" name="toCollection" value="{{collection}}"> Create a new collection
              </label>
              <div class="form-group" style="margin:10px 0 0 40px;max-width:300px">
                <input type="text" class="form-control" name="newCollection" placeholder="enter collection name" disabled>
              </div>
              <div class="name-existed error" style="margin:5px 0 0 40px;display:none">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                Collection name existed!
              </div>
            </div>
            <!--<button type="submit" class="btn btn-default">Backup</button>-->
            <button type="button" class="btn btn-warning restore-button" disabled db-name="{{ db }}" collection="{{ collection }}">
              <span class="glyphicon glyphicon-paste"></span> Restore
            </button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>



{% if !settings.read_only %}
<div id="confirm-backup" class="modal fade" role="dialog" aria-labelledby="confirmBackupLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Backup database</h4>
      </div>

      <div class="modal-body">
        <p>
          Be careful! You are about to backup whole <strong><span id="modal-database-name"></span></strong> database.
        </p>
        <p>
          <label for="confirmation-input">Type the database name to proceed.</label>
          <input type="text" id="confirmation-input" name="confirmation-input" shouldbe="" value="" />
        </p>
      </div>

      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn  btn-success" id="backup">Backup</button>
        <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
      </div>
    </div>
  </div>
</div>



{% endif %}

{#
  # Still need to add global lock time stats and replica set stats
#}

{% endblock %}
